@page "/specialequipment"
@using Karma.Models
@using System.Linq;
<h1 class="mat">Special Equipment</h1>

<p>Here you can find the special equipment each volunteer owns.</p>

<table class="table">
    <tbody>
        <tr>
            <th>Name</th>
            <th>Surname</th>
            <th>Equipment</th>
        </tr>
        @foreach (var pair in GetPairsOfVolunteersAndEquipment())
        {
            <tr>
                <td>@pair.VolunteerName</td>
                <td>@pair.VolunteerSurname</td>
                <td>
                    @if (pair.EquipmentList != null)
                    {

                        @foreach(var equipmentItemName in pair.EquipmentList)
                        {
                            <div>
                                @equipmentItemName
                            </div>
                        }
                    }

                </td>
            </tr>
        }
    </tbody>
</table>

@code
{
    private KarmaContext KarmaContext { get; } = new KarmaContext();

    private IEnumerable<VolunteerAndEquipment> GetPairsOfVolunteersAndEquipment()
    {
        var vols = KarmaContext.Volunteers.ToList();
        var equipment = KarmaContext.SpecialEquipment.ToList();
        var pairs = vols.GroupJoin(equipment,
                         owner => owner,
                         eq => eq.Owner,
                         (owner, collection) =>
                             new VolunteerAndEquipment(owner.Name, owner.Surname, collection.Select(x => x.Name)));
        var orderedList = pairs.ToList().OrderByEquipmentCount();
        return orderedList;
    }
}
