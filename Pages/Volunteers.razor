@page "/volunteers"
@using Karma.Models
@using Microsoft.EntityFrameworkCore;
@using System.Linq;
<h1>Volunteers</h1>

<p>Here you can find the list of volunteers working on various projects.</p>

@if (m_httpContextAccessor.HttpContext.User.Identity.IsAuthenticated)
{
    <table class="table">
        <tbody>
            <tr>
                <th>Name</th>
                <th>Surname</th>
                <th>Events</th>
            </tr>
            @foreach (var volunteer in GetVolunteers())
            {
                <tr>
                    <td>@volunteer.Name</td>
                    <td>@volunteer.Surname</td>
                    <td>
                        @if (volunteer.Events != null)
                        {

                            @foreach (var karmaEvent in volunteer.Events)
                            {
                                <div @onclick="() => NavigateToIndividualEvent(karmaEvent.Id)">
                                    @karmaEvent.Name
                                </div>
                            }
                        }

                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <label for="fname">Please LogIn</label>
}
@code
{
    private KarmaContext KarmaContext { get; } = new KarmaContext();

    public IEnumerable<IVolunteer> GetVolunteers()
    {
        return KarmaContext.Volunteers.Include(x => x.Events);
    }

    public void NavigateToIndividualEvent(Guid id)
    {
        m_uriHelper.NavigateTo($"event/{id}");
    }
}
